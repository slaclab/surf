#-------------------------------------------------------------------------------
#-- Title         : JESD AdcKcu105 Board Constraints
#-- File          : JesdAdcKcu105.xdc
#-- Author        : Uros Legat <ulegat@slac.stanford.edu>
#-- Created       : 06/04/2015
#-------------------------------------------------------------------------------
#-- Description:
#-- Constrains for the Kcu105 JESD DAC TI ADC16DX370EVM
#-------------------------------------------------------------------------------
#-- Copyright (c) 2015 SLAC National Accelerator Laboratory
#-------------------------------------------------------------------------------
#-- Modification history:
#-- 06/04/2015: created.
#-------------------------------------------------------------------------------

#Clocks
create_clock -period 6.400 -name pgpRefClk [get_ports pgpRefClkP]

create_generated_clock -name pgpClk -source [get_ports pgpRefClkP] -multiply_by 1 [get_pins ClockManager7_PGP/MmcmGen.U_Mmcm/CLKOUT0]

create_clock -period 5.405 -name jesdRefClk [get_ports fpgaDevClkaP]

create_generated_clock -name jesdClk -divide_by 1 -source [get_ports {fpgaDevClkaP}] \
    [get_pins {ClockManager7_JESD/MmcmGen.U_Mmcm/CLKOUT0}]

set_clock_groups -asynchronous\
 -group [get_clocks -include_generated_clocks pgpRefClk]\
 -group [get_clocks -include_generated_clocks jesdRefClk]

#Assure that sychronization registers are placed in the same slice with no logic between each sync stage
set_property ASYNC_REG true [get_cells -hierarchical *crossDomainSyncReg_reg*]

# PGP REF Clk IO
set_property -dict {PACKAGE_PIN F12 IOSTANDARD LVCMOS18} [get_ports pgpRefClkSel]
set_property PACKAGE_PIN P5 [get_ports pgpRefClkN]
set_property PACKAGE_PIN P6 [get_ports pgpRefClkP]

# PGP GT ports (SFP0)
set_property PACKAGE_PIN A4 [get_ports pgpGtRxP]
set_property PACKAGE_PIN A3 [get_ports pgpGtRxN]
set_property PACKAGE_PIN B6 [get_ports pgpGtTxP]
set_property PACKAGE_PIN B5 [get_ports pgpGtTxN]

# JESD reference clock (Generated by LMK)
# Spare_Dclk8_P(AMC 20)
# Spare_Dclk8_N(AMC 21)
########################################################
set_property IOSTANDARD LVDS [get_ports fpgaDevClkaP]
set_property IOSTANDARD LVDS [get_ports fpgaDevClkaN]
set_property PACKAGE_PIN AB6  [get_ports fpgaDevClkaP]
set_property PACKAGE_PIN AB5  [get_ports fpgaDevClkaN]

# JESD SYSREF input (Generated by LMK)
# Spare_SDclk9_P(AMC 105)
# Spare_SDclk9_N(AMC 106)
########################################################
set_property IOSTANDARD LVDS [get_ports fpgaSysRefP]
set_property IOSTANDARD LVDS [get_ports fpgaSysRefN]
set_property PACKAGE_PIN AA34 [get_ports fpgaSysRefP]
set_property PACKAGE_PIN AB34 [get_ports fpgaSysRefN]

# ADC1 JESD NSYNC output
# FPGA_SDCLK_P(AMC 132)
# FPGA_SDCLK_N(AMC 133)
########################################################
set_property IOSTANDARD LVDS [get_ports syncb1P]
set_property IOSTANDARD LVDS [get_ports syncb1N]
set_property PACKAGE_PIN AE25 [get_ports syncb1P]
set_property PACKAGE_PIN AE26 [get_ports syncb1N]

# ADC2 JESD NSYNC output
# FPGA_SDCLK_P(AMC 117)
# FPGA_SDCLK_N(AMC 118)
########################################################
set_property IOSTANDARD LVDS [get_ports syncb2P]
set_property IOSTANDARD LVDS [get_ports syncb2N]
set_property PACKAGE_PIN AJ20 [get_ports syncb2P]
set_property PACKAGE_PIN AK20 [get_ports syncb2N]

# ADC3 JESD NSYNC output
# FPGA_SDCLK_P(AMC 102)
# FPGA_SDCLK_N(AMC 103)
########################################################
set_property IOSTANDARD LVDS [get_ports syncb3P]
set_property IOSTANDARD LVDS [get_ports syncb3N]
set_property PACKAGE_PIN AP24 [get_ports syncb3P]
set_property PACKAGE_PIN AP25 [get_ports syncb3N]

# DAC JESD NSYNC input
# FPGA_SDCLK_P(AMC 96)
# FPGA_SDCLK_N(AMC 97)
########################################################
#set_property IOSTANDARD LVDS [get_ports syncb4P]
#set_property IOSTANDARD LVDS [get_ports syncb4N]
#set_property PACKAGE_PIN AN23 [get_ports syncb4P]
#set_property PACKAGE_PIN AP23 [get_ports syncb4N]


# ADC GTH RX ports 
########################################################

# ADC CH1 (AMC 29,30)
set_property PACKAGE_PIN AP2 [get_ports {adcGtRxP[0]}]
set_property PACKAGE_PIN AP1 [get_ports {adcGtRxN[0]}]

# ADC CH2 (AMC 35,36)
set_property PACKAGE_PIN AM2 [get_ports {adcGtRxP[1]}]
set_property PACKAGE_PIN AM1 [get_ports {adcGtRxN[1]}]

# ADC CH3 (AMC 44,45)
set_property PACKAGE_PIN AH2 [get_ports {adcGtRxP[2]}]
set_property PACKAGE_PIN AH1 [get_ports {adcGtRxN[2]}]

# ADC CH4 (AMC 50,51)
set_property PACKAGE_PIN AF2 [get_ports {adcGtRxP[3]}]
set_property PACKAGE_PIN AF1 [get_ports {adcGtRxN[3]}]

# ADC CH5 (AMC 59,60)
set_property PACKAGE_PIN AD2 [get_ports {adcGtRxP[4]}]
set_property PACKAGE_PIN AD1 [get_ports {adcGtRxN[4]}]

# ADC CH6 (AMC 65,66)
set_property PACKAGE_PIN AC4 [get_ports {adcGtRxP[5]}]
set_property PACKAGE_PIN AC3 [get_ports {adcGtRxN[5]}]

#DAQ Trigger input (AMC-150- SPARE1_M)
set_property IOSTANDARD LVCMOS18 [get_ports trigHW]
set_property PACKAGE_PIN AK21 [get_ports trigHW]

####################################################################################
# Debug
####################################################################################

# Output leds DEBUG
set_property -dict {PACKAGE_PIN AP8 IOSTANDARD LVCMOS18} [get_ports {leds[0]}]
set_property -dict {PACKAGE_PIN H23 IOSTANDARD LVCMOS18} [get_ports {leds[1]}]
set_property -dict {PACKAGE_PIN P20 IOSTANDARD LVCMOS18} [get_ports {leds[2]}]
set_property -dict {PACKAGE_PIN P21 IOSTANDARD LVCMOS18} [get_ports {leds[3]}]
set_property -dict {PACKAGE_PIN N22 IOSTANDARD LVCMOS18} [get_ports {leds[4]}]
set_property -dict {PACKAGE_PIN M22 IOSTANDARD LVCMOS18} [get_ports {leds[5]}]
set_property -dict {PACKAGE_PIN R23 IOSTANDARD LVCMOS18} [get_ports {leds[6]}]
set_property -dict {PACKAGE_PIN P23 IOSTANDARD LVCMOS18} [get_ports {leds[7]}]

#SYSREF output DEBUG (J53-PIN1)
set_property PACKAGE_PIN AL14 [get_ports sysrefDbg]
set_property IOSTANDARD LVCMOS15 [get_ports sysrefDbg]

#Rising edge pulse output DEBUG (J53-PIN3)
set_property PACKAGE_PIN AM14 [get_ports rePulseDbg[0]]
set_property IOSTANDARD LVCMOS15 [get_ports rePulseDbg[0]]

#Rising edge pulse output DEBUG (J53-PIN4)
set_property PACKAGE_PIN AM15 [get_ports rePulseDbg[1]]
set_property IOSTANDARD LVCMOS15 [get_ports rePulseDbg[1]]

# User GPIO clock output (jesdClk)
set_property IOSTANDARD LVCMOS18 [get_ports gpioClk]
set_property PACKAGE_PIN H27 [get_ports gpioClk]

# Bitstream generation options
set_property BITSTREAM.CONFIG.CONFIGRATE 33 [current_design]
set_property CONFIG_VOLTAGE 1.8 [current_design]
set_property CFGBVS GND [current_design]
set_property BITSTREAM.CONFIG.SPI_32BIT_ADDR YES [current_design]
set_property BITSTREAM.CONFIG.SPI_BUSWIDTH 4 [current_design]
set_property BITSTREAM.CONFIG.SPI_FALL_EDGE YES [current_design]

