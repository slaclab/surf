##############################################################################
## This file is part of 'SLAC Firmware Standard Library'.
## It is subject to the license terms in the LICENSE.txt file found in the 
## top-level directory of this distribution and at: 
##    https://confluence.slac.stanford.edu/display/ppareg/LICENSE.html. 
## No part of 'SLAC Firmware Standard Library', including this file, 
## may be copied, modified, propagated, or distributed except according to 
## the terms contained in the LICENSE.txt file.
##############################################################################
#schemaversion 3.0.0
#once

JesdRx: &JesdRx
  class: MMIODev
  configPrio: 1
  description: JESD RX Module
  size: 0x200
  children:
    Enable:
      at:
        offset: 0x00
      class: IntField
      name: Enable
      sizeBits: 8
      mode: RW
      description: Enable[7:0]
    SysrefDelay:
    ######################################################### 
      at:
        offset: 0x04
      class: IntField
      name: SysrefDelay
      sizeBits: 5
      mode: RW
      description: Sets the synchronisation delay in clock cycles
    SubClass:
    #########################################################    
      at:
        offset: 0x10
      class: IntField
      name: SubClass
      sizeBits: 1
      lsBit: 0
      mode: RW
      description: SubClass
    ReplaceEnable:
    #########################################################  
      at:
        offset: 0x10
      class: IntField
      name: ReplaceEnable
      sizeBits: 1
      lsBit: 1
      mode: RW
      enums:
        - name: Disabled
          class: Enum
          value: 0
        - name:  Enabled
          class: Enum
          value: 1
      description: Jesd Character Replacement Enable (Leave Enabled in normal operation).
    ResetGTs:
    #########################################################  
      at:
        offset: 0x10
      class: IntField
      name: ResetGTs
      sizeBits: 1
      lsBit: 2
      mode: RW
      description: ResetGTs
    ClearErrors:
    #########################################################    
      at:
        offset: 0x10
      class: IntField
      name: ClearErrors
      sizeBits: 1
      lsBit: 3
      mode: RW
      description: ClearErrors
    InvertSync:
    ######################################################### 
      at:
        offset: 0x10
      class: IntField
      name: InvertSync
      sizeBits: 1
      lsBit: 4
      mode: RW
      enums:
        - name: Regular
          class: Enum
          value: 0
        - name: Inverted
          class: Enum
          value: 1
      description: Invert Sync. Sync output has to be inverted in some systems depending
        on signal polarities on the PCB.
    ScrambleEnable:
    ######################################################### 
      at:
        offset: 0x10
      class: IntField
      name: ScrambleEnable
      sizeBits: 1
      lsBit: 5
      mode: RW
      enums:
        - name: Disabled
          class: Enum
          value: 0
        - name: Enabled
          class: Enum
          value: 1
      description: Enable data Scrambling.
    GTXReady:
    #########################################################        
      at:
        offset: 0x040
        stride: 4
        nelms: 8
      class: IntField
      name: GTXReady
      sizeBits: 1
      lsBit: 0
      mode: RO
      description: GTXReady[7:0]
    DataValid:
    #########################################################        
      at:
        offset: 0x040
        stride: 4
        nelms: 8
      class: IntField
      name: DataValid
      sizeBits: 1
      lsBit: 1
      mode: RO
      description: DataValid[7:0]
    AlignErr:
    #########################################################        
      at:
        offset: 0x040
        stride: 4
        nelms: 8
      class: IntField
      name: AlignErr
      sizeBits: 1
      lsBit: 2
      mode: RO
      description: AlignErr[7:0]
    nSync:
    #########################################################        
      at:
        offset: 0x040
        stride: 4
        nelms: 8
      class: IntField
      name: nSync
      sizeBits: 1
      lsBit: 3
      mode: RO
      description: nSync[7:0]
    RxBuffUfl:
    #########################################################        
      at:
        offset: 0x040
        stride: 4
        nelms: 8
      class: IntField
      name: RxBuffUfl
      sizeBits: 1
      lsBit: 4
      mode: RO
      description: RxBuffUfl[7:0]
    RxBuffOfl:
    #########################################################        
      at:
        offset: 0x040
        stride: 4
        nelms: 8
      class: IntField
      name: RxBuffOfl
      sizeBits: 1
      lsBit: 5
      mode: RO
      description: RxBuffOfl[7:0]
    PositionErr:
    #########################################################        
      at:
        offset: 0x040
        stride: 4
        nelms: 8
      class: IntField
      name: PositionErr
      sizeBits: 1
      lsBit: 6
      mode: RO
      description: PositionErr[7:0]
    RxEnabled:
    #########################################################        
      at:
        offset: 0x040
        stride: 4
        nelms: 8
      class: IntField
      name: RxEnabled
      sizeBits: 1
      lsBit: 7
      mode: RO
      description: RxEnabled[7:0]
    SysRefDetected:
    #########################################################        
      at:
        offset: 0x041
        stride: 4
        nelms: 8
      class: IntField
      name: SysRefDetected
      sizeBits: 1
      lsBit: 0
      mode: RO
      description: SysRefDetected[7:0]
    CommaDetected:
    #########################################################        
      at:
        offset: 0x041
        stride: 4
        nelms: 8
      class: IntField
      name: CommaDetected
      sizeBits: 1
      lsBit: 1
      mode: RO
      description: CommaDetected[7:0]
    DisparityErr:
    #########################################################        
      at:
        offset: 0x041
        stride: 4
        nelms: 8
      class: IntField
      name: DisparityErr
      sizeBits: 4
      lsBit: 2
      mode: RO
      description: DisparityErr[7:0]
    DecErr:
    #########################################################        
      at:
        offset: 0x041
        stride: 4
        nelms: 8
      class: IntField
      name: DecErr
      sizeBits: 4
      lsBit: 6
      mode: RO
      description: DecErr[7:0]
    ElBuffLatency:
    #########################################################        
      at:
        offset: 0x042
        stride: 4
        nelms: 8
      class: IntField
      name: ElBuffLatency
      sizeBits: 4
      lsBit: 2
      mode: RO
      description: ElBuffLatency[7:0]
    Threshold_Low:
    #########################################################     
      at:
        offset: 0xC0
        stride: 4
        nelms: 8
      class: IntField
      name: Threshold_Low
      sizeBits: 16
      mode: RW
      description: Threshold_Low[7:0]. Debug funtionality. Threshold for generating
        a digital signal from the ADC data.
    Threshold_High:
    #########################################################   
      at:
        offset: 0xC2
        stride: 4
        nelms: 8
      class: IntField
      name: Threshold_High
      sizeBits: 16
      mode: RW
      description: Threshold_High[7:0]. Debug funtionality. Threshold for generating
        a digital signal from the ADC data.
    StatusValidCnt:
    #########################################################   
      at:
        offset: 0x100
        stride: 4
        nelms: 8
      class: IntField
      name: StatusValidCnt
      sizeBits: 32
      mode: RW
      description: StatusValidCnt[7:0]. Shows stability of JESD lanes. Counts number
        of JESD re-syncronisations.
    C_ClearErrors:
      name: C_ClearErrors
      class: SequenceCommand
      at:
        offset: 0x0
      description: Clear the registered errors of all RX lanes
      sequence:
      - entry: ClearErrors
        value: 0x1
      - entry: ClearErrors
        value: 0x0
    #########################################################
    C_ResetGTs:
      name: C_ResetGTs
      class: SequenceCommand
      at:
        offset: 0x0
      description: Toggle the reset of all RX MGTs
      sequence:
      - entry: ResetGTs
        value: 0x1
      - entry: ResetGTs
        value: 0x0
    #########################################################
