##############################################################################
## This file is part of 'SLAC Firmware Standard Library'.
## It is subject to the license terms in the LICENSE.txt file found in the 
## top-level directory of this distribution and at: 
##    https://confluence.slac.stanford.edu/display/ppareg/LICENSE.html. 
## No part of 'SLAC Firmware Standard Library', including this file, 
## may be copied, modified, propagated, or distributed except according to 
## the terms contained in the LICENSE.txt file.
##############################################################################

Device: &Lmk04828 
  name: Lmk04828
  description: LMK04828 Module
  size: 0x800
  #########
  IntField:
  #########
    #########################################################
    - offset: 0x400
      name: LmkReg
      sizeBits: 8
      stride: 4
      nelms: 126
      mode: RW
      description: LMK Registers[0x17d:0x100]           
    ######################################################### 
    - offset: 0x00C
      name: ID_DEVICE_TYPE
      sizeBits: 8
      mode: RO
      description: ID_DEVICE_TYPE 
    #########################################################
    - offset: 0x010
      name: ID_PROD_UPPER
      sizeBits: 8
      mode: RO
      description: ID_PROD_UPPER 
    #########################################################
    - offset: 0x014
      name: ID_PROD_LOWER
      sizeBits: 8
      mode: RO
      description: ID_PROD_LOWER 
    #########################################################
    - offset: 0x018
      name: ID_MASKREV
      sizeBits: 8
      mode: RO
      description: ID_MASKREV 
    #########################################################
    - offset: 0x030
      name: ID_VNDR_UPPER
      sizeBits: 8
      mode: RO
      description: ID_VNDR_UPPER     
    #########################################################
    - offset: 0x034
      name: ID_VNDR_LOWER
      sizeBits: 8
      mode: RO
      description: ID_VNDR_LOWER           
    #########################################################
    - offset: 0x4E4    
      name: EnableSysRef
      sizeBits: 2    
      lsBit: 0 
      mode: RW
      description: EnableSysRef 
    #########################################################
    - offset: 0x510    
      name: EnableSync
      sizeBits: 8 
      lsBit: 0 
      mode: RW
      description: EnableSync   
    #########################################################
    - offset: 0x50C
      name: SyncBit
      sizeBits: 1
      lsBit: 5 
      mode: RW
      description: SyncBit         
    #########################################################
  #########
  Commands:
  #########      
    #########################################################
    - name: InitLmk
      description: Synchronise LMK internal counters. Warning this function will power off and power on all the system clocks          
      sequence:
        # Turn off normal continuous sysref
        - entry: EnableSysRef
          value: 0x0 
        # Turn On SYNC
        - entry: EnableSync
          value: 0x0           
        # 1000 ms sleep
        - entry: usleep
          set: 1000000 
        # Toggle Sync bit
        - entry: SyncBit
          value: 0x1    
        - entry: SyncBit
          value: 0x0        
        # 1000 ms sleep
        - entry: usleep
          set: 1000000           
        # Turn on normal continuous sysref
        - entry: EnableSysRef
          value: 0x3           
        # Turn Off SYNC
        - entry: EnableSync
          value: 0xff            
    #########################################################
    - name: PwrUpSysRef
      description: Powerup the sysref lines        
      sequence:
        # Turn on normal continuous sysref
        - entry: EnableSysRef
          value: 0x3
    #########################################################
    - name: PwrDwnSysRef
      description: Powerdown the sysref lines        
      sequence:
        # Turn off normal continuous sysref
        - entry: EnableSysRef
          value: 0x0          
    #########################################################
